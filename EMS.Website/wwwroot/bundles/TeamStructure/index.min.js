(function(n){function t(){function r(){n("#UserId").on("change",function(){t()})}function t(){n.ajax({type:"POST",url:domain+"teamstructure/teamstructure",data:{userId:n("#UserId").val()},success:function(t){function y(){}function c(n){var t=s.nodes(r).reverse(),v=s.links(t),i,o,c,l,f;t.forEach(function(n){n.y=n.depth*180});i=h.selectAll("g.node").data(t,function(n){return n.id||(n.id=++a)});o=i.enter().append("g").attr("class","node").attr("transform",function(){return"translate("+n.y0+","+n.x0+")"}).on("click",p);o.append("circle").attr("r",1e-6).style("fill",function(n){return n._children?"lightsteelblue":"#fff"});o.append("text").attr("x",function(n){return n.children||n._children?-10:10}).attr("dy",".35em").attr("text-anchor",function(n){return n.children||n._children?"end":"start"}).text(function(n){return n.name}).style("fill-opacity",1e-6);c=i.transition().duration(u).attr("transform",function(n){return"translate("+n.y+","+n.x+")"});c.select("circle").attr("r",4.5).style("fill",function(n){return n._children?"lightsteelblue":"#fff"});c.select("text").style("fill-opacity",1);l=i.exit().transition().duration(u).attr("transform",function(){return"translate("+n.y+","+n.x+")"}).remove();l.select("circle").attr("r",1e-6);l.select("text").style("fill-opacity",1e-6);f=h.selectAll("path.link").data(v,function(n){return n.target.id});f.enter().insert("path","g").attr("class","link").attr("d",function(){var t={x:n.x0,y:n.y0};return e({source:t,target:t})});f.transition().duration(u).attr("d",e);f.exit().transition().duration(u).attr("d",function(){var t={x:n.x,y:n.y};return e({source:t,target:t})}).remove();t.forEach(function(n){n.x0=n.x;n.y0=n.y})}function p(n){n.children?(n._children=n.children,n.children=null):(n.children=n._children,n._children=null);c(n)}n("#tree-view").empty();var l=n("#tree-view").innerWidth(),i={top:20,right:120,bottom:20,left:120},o=l-i.right-i.left,f=t.maxLimit*30-i.top-i.bottom,a=0,u=750,r,s=d3.layout.tree().size([f,o]),e=d3.svg.diagonal().projection(function(n){return[n.y,n.x]}),h=d3.select("#tree-view").append("svg").attr("width",o+i.right+i.left).attr("height",f+i.top+i.bottom).append("g").attr("transform","translate("+i.left+","+i.top+")"),v=t;r=v;r.x0=f/2;r.y0=0;r.children.forEach(y);c(r);d3.select(self.frameElement).style("height","800px")}})}var i=this;i.init=function(){r();t()}}n(function(){var n=new t;n.init()})})(jQuery);