(function(n){function t(){function r(){n(".divoverlay").removeClass("hide");t=new Global.GridHelper("#grid-device-history",{serverSide:!0,destroy:!0,ordering:!1,pageLength:15,bFilter:!1,bAutoWidth:!1,bLengthChange:!1,ajax:{url:domain+"device/index",type:"POST",data:f()},columnDefs:[{width:"2%",targets:0},{width:"10%",targets:1},{width:"15%",targets:2},{width:"12%",targets:3},{width:"12%",targets:4},{width:"12%",targets:5},{width:"5%",targets:6}],columns:[{name:"rowIndex",data:"rowIndex",title:"#",sortable:!1,searchable:!1,visible:!0},{name:"DeviceName",data:"deviceName",title:"Device",sortable:!1,searchable:!1,visible:!0,render:function(n,t,i){return i.simDetails==""?n:n+"<br>"+i.simDetails}},{name:"Condition",data:"condition",title:"Condition",sortable:!1,searchable:!1,visible:!0},{name:"PrevDeviceUser",data:"prevDeviceUser",title:"Previous Assigned Person",sortable:!1,searchable:!1,visible:!0,render:function(n,t,i){return n?n+"<br>"+i.prevDeviceUserPeriod:n}},{name:"AssignedTo",data:"assignedTo",title:"New Assigned Person",sortable:!1,searchable:!1,visible:!0,render:function(n,t,i){return n+"<br>"+i.assignedDate}},{name:"AssignedBy",data:"assignedBy",title:"Assigned By",sortable:!1,searchable:!1,visible:!0},{name:"Action",data:null,title:"Action",sortable:!1,searchable:!1,render:function(t,i,r){var u="";return r.recieveAllowed&&(u+=n("<a/>",{id:"addEdit","class":"btn btn-default btn-sm",href:domain+"device/addreturndevice/"+r.id,"data-toggle":"modal","data-target":"#modal-return-device","data-backdrop":"static",html:n("<i/>",{"class":"fa fa-pencil",style:"color:black"}).get(0).outerHTML+"&nbsp; Receive"}).get(0).outerHTML+"&nbsp; "),u}},],fnRowCallback:function(t,i){i.isSubmitted&&n("td",t).css({"background-color":"#9dff9d",color:"black"})},fnDrawCallback:function(t){n(".divoverlay").addClass("hide");t._iDisplayLength>t.fnRecordsDisplay()?n(".dataTables_paginate").hide():n(".dataTables_paginate").show();n(".pagination .active a").css("background-color","#e99701");n(".pagination .active a").css("border-color","#e99701")}})}function f(){return{historyType:n("#HistoryType").val(),deviceType:n("#DeviceType").val(),deviceId:n("#DeviceId").val()}}function e(){n("#modal-assign-device").on("loaded.bs.modal",function(){var u=n(this),r=new Global.FormHelper(u.find("form"),{updateTargetId:"NotificationMessage"},null,function(n){n.isSuccess?(u.modal("hide"),t.ajax.reload(),Global.ShowMessage(n.message,!0,"NotificationMessage")):r.find("#NotificationMessage").html(n)});r.find("#AssignedDateTime").datepicker({dateFormat:"dd/mm/yy",maxDate:new Date});i(r);r.on("change","#DeviceType",function(){i(r)});r.on("change","#DeviceId",function(){var t=r.find("#spnQuanityError");t.html("");n(this).find("option:selected").data("availablestock")||t.html("Stock is not avaliable for selected device")})}).on("hidden.bs.modal",function(){n(this).removeData("bs.modal");n(this).find(".modal-content").empty()});n("#modal-return-device").on("loaded.bs.modal",function(){var u=n(this),i=new Global.FormHelper(u.find("form"),{updateTargetId:"NotificationMessage"},null,function(n){n.isSuccess?(u.modal("hide"),t.ajax.reload(),Global.ShowMessage(n.message,!0,"divMessage")):i.find("#NotificationMessage").html(n)}),r=i.find("#AssignedDate").val().split("-"),f=new Date(r[0],r[1]-1,r[2]);i.find("#ReturnDate").datepicker({dateFormat:"dd/mm/yy",maxDate:new Date,minDate:f})}).on("hidden.bs.modal",function(){n(this).removeData("bs.modal");n(this).find(".modal-content").empty()});n("#btnSearch").on("click",function(){r()});var u=n("#deviceHistory");u.on("change","#DeviceType",function(){i(u,"All Devices")})}function i(t,i){var r=t.find("#DeviceType").val(),u=t.find("#DeviceId");u.html("<option value>"+(i||"Select Device")+"<\/option>");r!=""&&n.ajax({url:domain+"device/getdevicenamelist",type:"GET",data:{deviceType:r},success:function(t){var r="";r=r+"<option value>"+(i||"Select Device")+"<\/option>";n(t).each(function(n,t){r=r+"<option data-availablestock="+t.availableStock+" value="+t.id+">"+t.name+" [Stock: "+t.availableStock+"]<\/option>"});u.html(r)}})}var u=this,t;u.init=function(){r();e()}}n(function(){var n=new t;n.init()})})(jQuery);